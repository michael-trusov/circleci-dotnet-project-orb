description: >
  This command pack binaries in Docker image and push it to the registry. This command expect
  environment variables ACR_URL, ACR_USERNAME and ACR_PASSWORD to be set in the context.

parameters:
  imageName:
    type: string
    description: "Docker image name"

  imageTag:
    type: string
    description: "Docker image tag"

steps:
  - checkout

  - run:
      name: "Pack and Push: build '<< parameters.imageName >>:<< parameters.imageTag >>' version of docker image"
      environment:
        CONTAINER_REGISTRY_URL: $ACR_URL
        IMAGE_NAME: << parameters.imageName >>
        IMAGE_TAG: << parameters.imageTag >>
      command: <<include(scripts/build_docker.sh)>>

  - run:
      name: "Pack and Push: push '<< parameters.imageName >>:<< parameters.imageTag >>' version of docker image to Container Registry"
      environment:
        CONTAINER_REGISTRY_URL: $ACR_URL
        CONTAINER_REGISTRY_USERNAME: $ACR_USERNAME
        CONTAINER_REGISTRY_PASSWORD: $ACR_PASSWORD
        IMAGE_NAME: << parameters.imageName >>
        IMAGE_TAG: << parameters.imageTag >>
      command: <<include(scripts/push_docker.sh)>>
