description: >
  This command can produce Helm chart and push it to the Helm repository.

parameters:
  helmRepo:
    type: string
    description: "Helm repository URL"
  helmChartName:
    type: string
    description: "Helm chart name"
  helmChartVersion:
    type: string
    description: "Helm chart version"

environment:
  DOTNET_SKIP_FIRST_TIME_EXPERIENCE: "1"
  DOTNET_CLI_TELEMETRY_OPTOUT: "1"
  HELM_EXPERIMENTAL_OCI: "1"

steps:
  - checkout

  - helm/install-helm-client:
      version: "v3.2.0"

  - run:
      name: "Pack and Push: package and publish Helm chart"
      environment:
        CONTAINER_REGISTRY_URL: $ACR_URL
        CONTAINER_REGISTRY_USERNAME: $ACR_USERNAME
        CONTAINER_REGISTRY_PASSWORD: $ACR_PASSWORD
        HELM_REPO: << parameters.helmRepo >>
        HELM_CHART_NAME: << parameters.imageName >>
        HELM_CHART_VERSION: << parameters.imageTag >>
      command: include(scripts/pack_and_push_helm.sh)
